(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{zljH:function(t,e,n){"use strict";n.r(e),n.d(e,"PageModule",function(){return J});var o=n("W5dm"),i=n("UXJo"),a=n("3Pt+"),s=n("mrSG"),c=n("6vI4"),r=n("WGO7"),b=n("7+mf"),l=n("0Z/k"),d=n("XNiG"),h=n("2Vo4"),u=n("1G5W"),g=n("bYjQ"),p=n("597B"),m=n("fXoL"),f=n("tyNb"),O=n("CTL+"),v=n("bTqV"),y=n("NFeN"),_=n("Wp6s"),C=n("ofXK"),M=n("oNgS");let P=(()=>{class t{transform(t){var e;return null!==(e=p.i[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=m.Lb({name:"peerStateBadge",type:t,pure:!0}),t})(),w=(()=>{class t{transform(t){var e;return null!==(e=p.h[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=m.Lb({name:"peerSignalBadge",type:t,pure:!0}),t})();const k=["local"],x=["remote"];function S(t,e){if(1&t&&(m.Qb(0),m.Nb(1,"speek-splash",13),m.ec(2,"peerSignalBadge"),m.ec(3,"async"),m.Pb()),2&t){const t=m.dc();m.Bb(1),m.ic("message",m.fc(2,1,m.fc(3,3,t.signal$)))}}const R=function(t,e){return{enabled:t,disabled:e}};let j=(()=>{class t{constructor(t,e,n,o,i,a){this.router=t,this.route=e,this.peer=n,this.stream=o,this.transfer=i,this.signaling=a,this.destroy=new d.a,this._audio=new h.a(!0),this.audio=this._audio.asObservable(),this._video=new h.a(!0),this.video=this._video.asObservable(),this.sender=r.a.short(),this.signal=new h.a("closed"),this.signal$=this.signal.asObservable(),this.state=new h.a("disconnected"),this.state$=this.state.asObservable(),this.track=new d.a,this.onTrack=this.track.asObservable(),this.status=new d.a,this.status$=this.status.asObservable();const{code:s}=this.route.snapshot.params;this.code=s}ngOnInit(){this.signaling.on(g.a.Offer).pipe(Object(u.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new g.b(this.sender,this.code);this.signaling.send(g.a.CreateOrJoin,t),this.peer.onSignal.subscribe(t=>{this.signal.next(t)}),this.peer.createChannel("channel").then(t=>{}),this.peer.onState.subscribe(t=>{console.log("state: ",t),this.state.next(t),"connected"===t&&console.log("CONNECTED"),"disconnected"===t&&(this.remote.srcObject=null)}),this.peer.onCandidate.pipe(Object(u.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(u.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})}),this.peer.onNegotiationNeeded.subscribe(({target:t})=>{console.log("needed: ",t),this.status.next(t.connectionState)}),this.peer.onWarning.subscribe(({description:t})=>{console.log("needed: ",t),this.status.next(t)})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.signaling.on(g.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(g.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(s.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(r.f)(this.peer.connection)&&Object(r.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(n){throw new Error("handle-message: "+n)}})}makeChoice(t){return Object(s.a)(this,void 0,void 0,function*(){switch(t.type){case g.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case g.a.Answer:return this.peer.setRemote(t)}})}setLocal(t){this.stream.getStream({video:Object(c.d)(),audio:Object(c.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t;const e=t.getAudioTracks();this.peer.connection.addTrack(e.shift(),t);const n=t.getVideoTracks();this.peer.connection.addTrack(n.shift(),t),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}sendOffer(t){this.signaling.send(g.a.Offer,new g.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}openTransfer(){this.transfer.open(this.peer.connection).subscribe(t=>{console.log(t)})}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(l.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(m.Mb(f.b),m.Mb(f.a),m.Mb(p.a),m.Mb(p.e),m.Mb(b.i),m.Mb(p.c))},t.\u0275cmp=m.Gb({type:t,selectors:[["speek-meet"]],viewQuery:function(t,e){if(1&t&&(m.Bc(k,1),m.Bc(x,1)),2&t){let t;m.mc(t=m.ac())&&(e.localRef=t.first),m.mc(t=m.ac())&&(e.remoteRef=t.first)}},decls:38,vars:32,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],[1,"meeting-room"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],[3,"ngClass"],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["aria-live","polite"],["type","button","mat-button","",3,"click"],["type","button","aria-label","Transferir dados","mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","aria-label","Encerrar liga\xe7\xe3o","color","warn",1,"call-end",3,"disabled","click"],[1,"room-code"],["width","200px",3,"message"]],template:function(t,e){1&t&&(m.Sb(0,"speek-toolbar"),m.Sb(1,"a",0),m.Sb(2,"mat-icon"),m.yc(3,"arrow_backward"),m.Rb(),m.Rb(),m.Sb(4,"span"),m.yc(5),m.ec(6,"peerStateBadge"),m.ec(7,"async"),m.Rb(),m.Rb(),m.Sb(8,"section",1),m.Nb(9,"video",2,3),m.Rb(),m.Sb(11,"mat-card",4),m.ec(12,"async"),m.ec(13,"async"),m.Nb(14,"video",5,6),m.Sb(16,"mat-card-actions",7),m.Sb(17,"button",8),m.Zb("click",function(){return e.toggleAudio()}),m.ec(18,"async"),m.Sb(19,"mat-icon"),m.yc(20),m.ec(21,"async"),m.Rb(),m.Rb(),m.Sb(22,"button",8),m.Zb("click",function(){return e.toggleVideo()}),m.ec(23,"async"),m.Sb(24,"mat-icon"),m.yc(25),m.ec(26,"async"),m.Rb(),m.Rb(),m.Sb(27,"button",9),m.Zb("click",function(){return e.openTransfer()}),m.Sb(28,"mat-icon"),m.yc(29,"swap_horiz"),m.Rb(),m.Rb(),m.Rb(),m.Rb(),m.wc(30,S,4,5,"ng-container",10),m.ec(31,"async"),m.Sb(32,"button",11),m.Zb("click",function(){return e.hangup()}),m.ec(33,"async"),m.Sb(34,"mat-icon"),m.yc(35,"call_end"),m.Rb(),m.Rb(),m.Sb(36,"span",12),m.yc(37),m.Rb()),2&t&&(m.Bb(5),m.Ac(" ",m.fc(6,9,m.fc(7,11,e.state$))," "),m.Bb(6),m.ic("ngClass",m.lc(29,R,!0===m.fc(12,13,e.video),!1===m.fc(13,15,e.video))),m.Bb(6),m.Cb("aria-label",m.fc(18,17,e.audio)?"Desabilitar \xe1udio":"Habilitar \xe1udio"),m.Bb(3),m.zc(m.fc(21,19,e.audio)?"mic":"mic_off"),m.Bb(2),m.Cb("aria-label",m.fc(23,21,e.video)?"Desabilitar v\xeddeo":"Habilitar v\xeddeo"),m.Bb(3),m.zc(m.fc(26,23,e.video)?"videocam":"videocam_off"),m.Bb(5),m.ic("ngIf","stable"!=m.fc(31,25,e.signal$)),m.Bb(2),m.ic("disabled","connected"!=m.fc(33,27,e.state$)),m.Bb(5),m.zc(e.code))},directives:[O.a,f.c,v.a,y.a,_.a,C.i,_.b,v.b,C.k,M.a],pipes:[P,C.b,w],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]{height:100%;position:relative}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   speek-lamp[_ngcontent-%COMP%], [_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{flex:1;width:100%;height:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:6px;border-bottom-right-radius:0;border-top-right-radius:0;position:absolute;min-width:200px;max-width:260px;overflow:hidden;bottom:24px;width:25%;padding:0;right:0;z-index:2;opacity:1;transition:opacity .8s ease-out}[_nghost-%COMP%]   .mat-card.enabled[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{animation:swing-in-bottom-fwd .5s cubic-bezier(.175,.885,.32,1.275) both}[_nghost-%COMP%]   .mat-card.disabled[_ngcontent-%COMP%]{opacity:.6}[_nghost-%COMP%]   .mat-card.disabled[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{animation:swing-out-bottom-bck .45s cubic-bezier(.6,-.28,.735,.045) both}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;opacity:.8}[_nghost-%COMP%]   .room-code[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;opacity:.3}@keyframes swing-in-bottom-fwd{0%{transform:rotateX(100deg);transform-origin:bottom;opacity:0}to{transform:rotateX(0);transform-origin:bottom;opacity:1}}@keyframes swing-out-bottom-bck{0%{transform:rotateX(0);transform-origin:bottom;opacity:1}to{transform:rotateX(100deg);transform-origin:bottom;opacity:0}}"]}),t})();var T=n("Kj3r"),B=n("GhD8"),I=n("kmnG"),N=n("qFsG");let V=(()=>{class t{constructor(t,e,n,o,i){this._router=t,this._route=e,this._share=n,this._builder=o,this._userRoom=i,this.destroy=new d.a,this.comeInOut=new h.a(!1),this.form=this._builder.group({code:[a.p.required,a.p.pattern(r.a.regex)]})}get enter(){return this.comeInOut.value}onPaste(t){if(t.stopPropagation(),t.preventDefault(),"clipboardData"in t||"clipboardData"in window){const e=(t.clipboardData||window.clipboardData).getData("Text"),n=r.a.getFromText(e);let o;(o=null==n?void 0:n.shift())&&this.code.patchValue(o),t.target.blur()}}get code(){return this.form.get("code")}ngOnInit(){const{code:t}=this._route.snapshot.params;this.form.patchValue({code:null!=t?t:""}),this.form.valueChanges.pipe(Object(T.a)(600),Object(u.a)(this.destroy)).subscribe(()=>this.onCodeChange())}onCodeChange(){if(this.form.valid){const t=this.code.value;setTimeout(()=>this.comeInOut.next(!0),400),this._userRoom.update(g.c.fromJson(this.form.value)),setTimeout(()=>this._router.navigate(["/",t,"meet"]),2400)}}share(){this._share.open().pipe(Object(u.a)(this.destroy)).subscribe(t=>{})}create(){this.go(r.a.long())}go(t){t&&this._router.navigate(["/",t,"meet"])}ngOnDestroy(){this.destroy.next(),this.destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(m.Mb(f.b),m.Mb(f.a),m.Mb(b.f),m.Mb(a.c),m.Mb(B.a))},t.\u0275cmp=m.Gb({type:t,selectors:[["speek-home"]],hostVars:2,hostBindings:function(t,e){1&t&&m.Zb("paste",function(t){return e.onPaste(t)},!1,m.pc),2&t&&m.Eb("zoom",e.enter)},decls:22,vars:1,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],["svgIcon","speek-logo"],[1,"brand-name"],[1,"flex","col","justify-center"],[1,"mat-h3"],["color","primary","mat-raised-button","","aria-label","Iniciar conversa",3,"click"],[1,"mat-h2"],[1,"flex","col","justify-center",3,"formGroup"],["appearance","outline","color","primary"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","autocomplete","off","formControlName","code"]],template:function(t,e){1&t&&(m.Sb(0,"speek-toolbar"),m.Sb(1,"a",0),m.Nb(2,"mat-icon",1),m.Rb(),m.Sb(3,"span",2),m.yc(4,"speek"),m.Rb(),m.Rb(),m.Sb(5,"section",3),m.Sb(6,"h3",4),m.yc(7," The most private way of chatting "),m.Rb(),m.Sb(8,"button",5),m.Zb("click",function(){return e.create()}),m.yc(9," Create new private room "),m.Rb(),m.Rb(),m.Sb(10,"section",3),m.Sb(11,"h2",6),m.yc(12,"OR"),m.Rb(),m.Rb(),m.Sb(13,"form",7),m.Sb(14,"mat-form-field",8),m.Sb(15,"mat-label"),m.yc(16," enter existing room key or link "),m.Rb(),m.Nb(17,"input",9),m.Sb(18,"mat-hint"),m.yc(19," provided by a host "),m.Rb(),m.Sb(20,"mat-error"),m.yc(21," your key doesn't work here "),m.Rb(),m.Rb(),m.Rb()),2&t&&(m.Bb(13),m.ic("formGroup",e.form))},directives:[O.a,f.c,v.a,y.a,v.b,a.q,a.m,a.h,I.c,I.g,N.a,a.b,a.l,a.f,I.f,I.b],styles:['[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;text-transform:none;position:relative}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}[_nghost-%COMP%]     speek-toolbar .mat-toolbar{background-color:transparent}[_nghost-%COMP%]:before{content:" ";width:100%;height:100%;position:absolute;background-image:url(/assets/descentralized.svg);background-position-x:center;background-position-y:center;background-repeat:no-repeat;background-size:105%;opacity:.02;transition:opacity .35s ease-in-out,background-size .4s ease}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]{letter-spacing:1.2px}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:12px}[_nghost-%COMP%]   .mat-fab[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}']}),t})();var D=n("LRne"),z=n("0IaG");let G=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,n,o){var i;const a=null===(i=t.state)||void 0===i?void 0:i.value;return"connected"===a||"connecting"===a?this._dialog.open(b.a,{data:{header:"Finalizar chamada",body:"\n        Voc\xea ainda est\xe1 conectado.\n        Cancele para continuar na\n        chamada ou encerre confirmando\n      "}}).afterClosed():Object(D.a)(!0)}canActivate(t,e){var n;const o=t.paramMap.get("code");if(r.a.isValid(o)){const t=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return t.pitch||this.userSetup.update(Object.assign(Object.assign({},t),{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(m.Wb(z.b),m.Wb(B.b))},t.\u0275prov=m.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),A=(()=>{class t{}return t.\u0275mod=m.Kb({type:t}),t.\u0275inj=m.Jb({factory:function(e){return new(e||t)},imports:[[f.d.forChild([{path:"",component:V},{path:"invite",component:V},{path:"invite/:code",component:V},{path:":code",redirectTo:":code/meet"},{path:":code/meet",canActivate:[G],canDeactivate:[G],component:j}])],f.d]}),t})();var L=n("0MNC"),E=n("u47x");let J=(()=>{class t{}return t.\u0275mod=m.Kb({type:t}),t.\u0275inj=m.Jb({factory:function(e){return new(e||t)},providers:[P],imports:[[C.c,E.a,b.g,b.b,b.e,L.c,b.h,o.a,i.b,a.o,A]]}),t})()}}]);