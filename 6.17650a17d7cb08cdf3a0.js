(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{zljH:function(t,e,n){"use strict";n.r(e),n.d(e,"PageModule",function(){return ut});var o=n("d3UM"),i=n("bTqV"),a=n("/t3+"),s=n("kmnG"),c=n("5RNC"),r=n("NFeN"),l=n("3Pt+"),d=n("ofXK"),b=n("fXoL");let h=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},imports:[[d.c,r.b,c.b,o.b,i.c,a.b,s.e,l.o],l.o]}),t})();var u=n("W5dm"),p=n("UXJo"),m=n("7+mf"),g=n("Qdhi");const f=["localAudio"];let v=(()=>{class t{constructor(t){this._fb=t,this.form=this._fb.group({sendTones:[{value:"",disabled:!0}],duration:[500],gap:[50],tones:["1199##9,6633221,9966332,9966332,1199##9,6633221"]}),this.gap=new l.d(50),this.duration=new l.d(500)}onClicked(t){console.log(t)}call(){console.log(this.audio)}sendTones(){}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(l.c))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-dialup"]],viewQuery:function(t,e){if(1&t&&(b.Cc(f,1),b.Cc(m.c,1)),2&t){let t;b.nc(t=b.bc())&&(e.audioRef=t.first),b.nc(t=b.bc())&&(e.dialPad=t.first)}},decls:1,vars:0,consts:[[3,"onClick"]],template:function(t,e){1&t&&(b.Tb(0,"speek-dialpad",0),b.ac("onClick",function(t){return e.onClicked(t)}),b.Sb())},directives:[g.a],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   section[_ngcontent-%COMP%]{padding:0 12px;display:flex;justify-content:space-between;align-items:center}"]}),t})();var O=n("Kj3r"),C=n("1G5W"),_=n("GhD8"),y=n("qFsG"),w=n("0Z/k"),S=n("XNiG"),k=n("2Vo4"),T=n("bYjQ"),M=n("WGO7"),P=n("tyNb"),x=n("CTL+"),j=n("a7DZ"),z=n("Wp6s");const N=function(t){return{hide:t}};let A=(()=>{class t{constructor(t,e,n){this._router=t,this._route=e,this._userRoom=n,this._destroy=new S.a,this.comeInOut=new k.a(!1),this.form=new l.g({code:new l.d("",[l.p.required,l.p.pattern(M.a.regex)])})}get enter(){return this.comeInOut.value}onPaste(t){if(t.stopPropagation(),t.preventDefault(),"clipboardData"in t||"clipboardData"in window){const e=(t.clipboardData||window.clipboardData).getData("Text"),n=M.a.getFromText(e);let o;(o=null==n?void 0:n.shift())&&this.code.patchValue(o),t.target.blur()}}get code(){return this.form.get("code")}ngOnInit(){const{code:t}=this._route.snapshot.params;this.form.patchValue({code:null!=t?t:""}),this.form.valueChanges.pipe(Object(O.a)(600),Object(C.a)(this._destroy)).subscribe(()=>this.onCodeChange())}onCodeChange(){if(this.form.valid){const t=this.code.value;setTimeout(()=>this.comeInOut.next(!0),400),this._userRoom.update(T.c.fromJson(this.form.value)),setTimeout(()=>this._router.navigate(["/",t,"meet"]),2400)}}ngOnDestroy(){this.stream&&Object(w.b)(this.stream),this._destroy.next(),this._destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(P.b),b.Nb(P.a),b.Nb(_.a))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-invite"]],viewQuery:function(t,e){if(1&t&&b.Cc(y.a,1),2&t){let t;b.nc(t=b.bc())&&(e.input=t.first)}},hostVars:2,hostBindings:function(t,e){1&t&&b.ac("paste",function(t){return e.onPaste(t)},!1,b.qc),2&t&&b.Fb("zoom",e.enter)},decls:19,vars:9,consts:[["routerLink","/","mat-icon-button","","tabindex","-1"],[1,"brand-name"],[3,"opened"],[3,"ngClass"],[3,"formGroup"],["appearance","outline","color","accent"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","autocomplete","off","formControlName","code"]],template:function(t,e){1&t&&(b.Tb(0,"speek-toolbar"),b.Tb(1,"a",0),b.Tb(2,"mat-icon"),b.zc(3,"arrow_backward"),b.Sb(),b.Sb(),b.Tb(4,"span",1),b.zc(5,"convidado"),b.Sb(),b.Sb(),b.Ob(6,"speek-door",2),b.fc(7,"async"),b.Tb(8,"mat-card",3),b.fc(9,"async"),b.Tb(10,"form",4),b.Tb(11,"mat-form-field",5),b.Tb(12,"mat-label"),b.zc(13,"Entre com a chave da reuni\xe3o"),b.Sb(),b.Ob(14,"input",6),b.Tb(15,"mat-hint"),b.zc(16,"Caso n\xe3o tenha, pe\xe7a ao seu anfitri\xe3o"),b.Sb(),b.Tb(17,"mat-error"),b.zc(18,"Chave inv\xe1lida"),b.Sb(),b.Sb(),b.Sb(),b.Sb()),2&t&&(b.Bb(6),b.jc("opened",b.gc(7,3,e.comeInOut)),b.Bb(2),b.jc("ngClass",b.lc(7,N,b.gc(9,5,e.comeInOut))),b.Bb(2),b.jc("formGroup",e.form))},directives:[x.a,P.c,i.a,r.a,j.a,z.a,d.i,l.q,l.m,l.h,s.c,s.g,y.a,l.b,l.l,l.f,s.f,s.b],pipes:[d.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transition:transform 3s ease-in-out}.zoom[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transform:scale(5)}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}"]}),t})();var I=n("Qu3c");const V=["tip"],B=function(t){return{hide:t}};let R=(()=>{class t{constructor(t,e){this._router=t,this._userRoom=e,this.url="https://speek.video/#/invite",this.comeInOut=new k.a(!1),this.form=new l.g({code:new l.d("",[l.p.required,l.p.pattern(M.a.regex)])})}get enter(){return this.comeInOut.value}get code(){return this.form.get("code")}ngOnInit(){const t=M.a.long();this.code.setValue(t),this.url=`${this.url}/${t}`}ngAfterViewInit(){this.tip&&(this.showTip=window.setTimeout(()=>{this.tip.show(),this.hideTip=window.setTimeout(()=>{this.tip.hide(),this.tip.message="Copiado",window.clearTimeout(this.hideTip)},2250),window.clearTimeout(this.showTip)},750))}onCopy(t){t.show(),this._userRoom.update(T.c.fromJson(this.form.value)),setTimeout(()=>t.hide(),750),setTimeout(()=>this.comeInOut.next(!0),1e3),setTimeout(()=>this._router.navigate(["/",this.code.value,"meet"]),3e3)}ngOnDestroy(){this.toggleTip&&window.clearInterval(this.toggleTip)}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(P.b),b.Nb(_.a))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-create"]],viewQuery:function(t,e){if(1&t&&b.Cc(V,1),2&t){let t;b.nc(t=b.bc())&&(e.tip=t.first)}},hostVars:2,hostBindings:function(t,e){2&t&&b.Fb("zoom",e.enter)},decls:21,vars:10,consts:[["routerLink","/","mat-icon-button",""],[1,"brand-name"],[3,"opened"],[3,"ngClass"],[3,"formGroup"],["appearance","outline","color","accent"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","formControlName","code"],["matSuffix","","type","button","mat-icon-button","",3,"cdkCopyToClipboard","click"],["matTooltip","Copiar chave","matTooltipPosition","above"],["tip","matTooltip"]],template:function(t,e){if(1&t){const t=b.Ub();b.Tb(0,"speek-toolbar"),b.Tb(1,"a",0),b.Tb(2,"mat-icon"),b.zc(3,"arrow_backward"),b.Sb(),b.Sb(),b.Tb(4,"span",1),b.zc(5,"come\xe7ar"),b.Sb(),b.Sb(),b.Ob(6,"speek-door",2),b.fc(7,"async"),b.Tb(8,"mat-card",3),b.fc(9,"async"),b.Tb(10,"form",4),b.Tb(11,"mat-form-field",5),b.Tb(12,"mat-label"),b.zc(13,"Copie sua chave clicando ao lado"),b.Sb(),b.Ob(14,"input",6),b.Tb(15,"mat-hint"),b.zc(16,"Voc\xea precisa copiar a chave antes de entrar"),b.Sb(),b.Tb(17,"button",7),b.ac("click",function(){b.rc(t);const n=b.oc(19);return e.onCopy(n)}),b.Tb(18,"mat-icon",8,9),b.zc(20," content_copy "),b.Sb(),b.Sb(),b.Sb(),b.Sb(),b.Sb()}2&t&&(b.Bb(6),b.jc("opened",b.gc(7,4,e.comeInOut)),b.Bb(2),b.jc("ngClass",b.lc(8,B,b.gc(9,6,e.comeInOut))),b.Bb(2),b.jc("formGroup",e.form),b.Bb(7),b.jc("cdkCopyToClipboard",e.url))},directives:[x.a,P.c,i.a,r.a,j.a,z.a,d.i,l.q,l.m,l.h,s.c,s.g,y.a,l.b,l.l,l.f,s.f,i.b,s.h,p.a,I.a],pipes:[d.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transition:transform 3s ease-in-out}.zoom[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transform:scale(5)}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}@keyframes flicker-1{0%,to{color:#fff}41.99%{color:#fff}42%{color:#00bcd4}44.80%{color:#00bcd4}45.01%{color:#fff}47.99%{color:#fff}48%{color:#00bcd4}49%{color:#00bcd4}49.01%{color:#fff}}"]}),t})();var L=n("mrSG"),D=n("6vI4"),E=n("597B"),$=n("oNgS");let G=(()=>{class t{transform(t){var e;return null!==(e=E.i[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=b.Mb({name:"peerStateBadge",type:t,pure:!0}),t})(),J=(()=>{class t{transform(t){var e;return null!==(e=E.h[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=b.Mb({name:"peerSignalBadge",type:t,pure:!0}),t})();const F=["local"],H=["remote"];function Q(t,e){if(1&t&&(b.Rb(0),b.Ob(1,"speek-splash",10),b.fc(2,"peerSignalBadge"),b.fc(3,"async"),b.Qb()),2&t){const t=b.ec();b.Bb(1),b.jc("message",b.gc(2,1,b.gc(3,3,t.signal$)))}}let X=(()=>{class t{constructor(t,e,n,o,i,a,s,c,r){this.router=t,this.share=e,this.route=n,this.peer=o,this.drawer=i,this.stream=a,this.userRoom=s,this.userSetup=c,this.signaling=r,this.destroy=new S.a,this._audio=new k.a(!0),this.audio=this._audio.asObservable(),this._video=new k.a(!0),this.video=this._video.asObservable(),this.sender=M.a.short(),this.signal=new k.a("closed"),this.signal$=this.signal.asObservable(),this.state=new k.a("disconnected"),this.state$=this.state.asObservable(),this.track=new S.a,this.onTrack=this.track.asObservable(),this.status=new S.a,this.status$=this.status.asObservable();const{code:l}=this.route.snapshot.params;this.code=l}ngOnInit(){this.signaling.on(T.a.Offer).pipe(Object(C.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new T.b(this.sender,this.code);this.signaling.send(T.a.CreateOrJoin,t),this.peer.onSignal.subscribe(t=>{this.signal.next(t)}),this.peer.onState.subscribe(t=>{console.log("state: ",t),this.state.next(t),"disconnected"===t&&(this.remote.srcObject=null)}),this.peer.onCandidate.pipe(Object(C.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(C.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})}),this.peer.onNegotiationNeeded.subscribe(({target:t})=>{console.log("needed: ",t),this.status.next(t.connectionState)}),this.peer.onWarning.subscribe(({description:t})=>{console.log("needed: ",t),this.status.next(t)})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.signaling.on(T.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(T.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(L.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(M.f)(this.peer.connection)&&Object(M.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(n){throw new Error("handle-message: "+n)}})}makeChoice(t){return Object(L.a)(this,void 0,void 0,function*(){switch(t.type){case T.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case T.a.Answer:return this.peer.setRemote(t)}})}setLocal(t){this.stream.getStream({video:Object(D.d)(),audio:Object(D.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t;const e=t.getAudioTracks();this.peer.connection.addTrack(e.shift(),t);const n=t.getVideoTracks();this.peer.connection.addTrack(n.shift(),t),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}sendOffer(t){this.signaling.send(T.a.Offer,new T.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(w.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(P.b),b.Nb(m.k),b.Nb(P.a),b.Nb(E.a),b.Nb(m.g),b.Nb(E.e),b.Nb(_.a),b.Nb(_.b),b.Nb(E.c))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-meet"]],viewQuery:function(t,e){if(1&t&&(b.Cc(F,1),b.Cc(H,1)),2&t){let t;b.nc(t=b.bc())&&(e.localRef=t.first),b.nc(t=b.bc())&&(e.remoteRef=t.first)}},decls:31,vars:18,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],[1,"meeting-room"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","color","warn",1,"call-end",3,"disabled","click"],[1,"room-code"],["width","200px",3,"message"]],template:function(t,e){1&t&&(b.Tb(0,"speek-toolbar"),b.Tb(1,"a",0),b.Tb(2,"mat-icon"),b.zc(3,"arrow_backward"),b.Sb(),b.Sb(),b.Tb(4,"span"),b.zc(5),b.fc(6,"peerStateBadge"),b.fc(7,"async"),b.Sb(),b.Sb(),b.Tb(8,"section",1),b.Ob(9,"video",2,3),b.Sb(),b.Tb(11,"mat-card"),b.Ob(12,"video",4,5),b.Tb(14,"mat-card-actions"),b.Tb(15,"button",6),b.ac("click",function(){return e.toggleAudio()}),b.Tb(16,"mat-icon"),b.zc(17),b.fc(18,"async"),b.Sb(),b.Sb(),b.Tb(19,"button",6),b.ac("click",function(){return e.toggleVideo()}),b.Tb(20,"mat-icon"),b.zc(21),b.fc(22,"async"),b.Sb(),b.Sb(),b.Sb(),b.Sb(),b.xc(23,Q,4,5,"ng-container",7),b.fc(24,"async"),b.Tb(25,"button",8),b.ac("click",function(){return e.hangup()}),b.fc(26,"async"),b.Tb(27,"mat-icon"),b.zc(28,"call_end"),b.Sb(),b.Sb(),b.Tb(29,"span",9),b.zc(30),b.Sb()),2&t&&(b.Bb(5),b.Bc(" ",b.gc(6,6,b.gc(7,8,e.state$))," "),b.Bb(12),b.Ac(b.gc(18,10,e.audio)?"mic":"mic_off"),b.Bb(4),b.Ac(b.gc(22,12,e.video)?"videocam":"videocam_off"),b.Bb(2),b.jc("ngIf","stable"!=b.gc(24,14,e.signal$)),b.Bb(2),b.jc("disabled","stable"!=b.gc(26,16,e.state$)),b.Bb(5),b.Ac(e.code))},directives:[x.a,P.c,i.a,r.a,z.a,z.b,i.b,d.k,$.a],pipes:[G,d.b,J],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#121212}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]{height:100%;position:relative}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   speek-lamp[_ngcontent-%COMP%], [_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{flex:1;width:100%;height:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;border-bottom-right-radius:0;border-top-right-radius:0;position:absolute;min-width:200px;max-width:260px;width:25%;bottom:24px;right:0;z-index:2}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px}[_nghost-%COMP%]   .room-code[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;opacity:.3}"]}),t})();var q=n("MutI"),K=n("f0Cb");let W=(()=>{class t{constructor(t,e){this._router=t,this._share=e,this.destroy=new S.a}share(){this._share.open().pipe(Object(C.a)(this.destroy)).subscribe(t=>{console.log(t)})}go(t){t&&this._router.navigate(["/",t])}ngOnDestroy(){this.destroy.next(),this.destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(P.b),b.Nb(m.k))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-home"]],decls:30,vars:0,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],["svgIcon","speek-logo"],[1,"brand-name"],["mat-card-subtitle",""],["mat-list-item","","routerLink","/create","aria-label","Iniciar conversa"],["mat-list-item","","routerLink","/invite","aria-label","Acessar conversa"],["mat-list-item","","routerLink","/setting","aria-label","Configura\xe7\xf5es"],["mat-fab","","aria-label","Compartilhar",3,"click"]],template:function(t,e){1&t&&(b.Tb(0,"speek-toolbar"),b.Tb(1,"a",0),b.Ob(2,"mat-icon",1),b.Sb(),b.Tb(3,"span",2),b.zc(4,"speek"),b.Sb(),b.Sb(),b.Tb(5,"mat-card"),b.Tb(6,"mat-card-header"),b.Tb(7,"h1",3),b.zc(8,"Como quer come\xe7ar?"),b.Sb(),b.Sb(),b.Tb(9,"mat-card-content"),b.Tb(10,"mat-nav-list"),b.Tb(11,"a",4),b.Tb(12,"mat-icon"),b.zc(13,"voice_chat"),b.Sb(),b.Tb(14,"span"),b.zc(15,"Iniciar conversa"),b.Sb(),b.Sb(),b.Tb(16,"a",5),b.Tb(17,"mat-icon"),b.zc(18,"mark_chat_unread"),b.Sb(),b.Tb(19,"span"),b.zc(20,"Acessar conversa"),b.Sb(),b.Sb(),b.Ob(21,"mat-divider"),b.Tb(22,"a",6),b.Tb(23,"mat-icon"),b.zc(24,"settings"),b.Sb(),b.Tb(25,"span"),b.zc(26,"Configura\xe7\xf5es"),b.Sb(),b.Sb(),b.Sb(),b.Sb(),b.Sb(),b.Tb(27,"button",7),b.ac("click",function(){return e.share()}),b.Tb(28,"mat-icon"),b.zc(29,"share"),b.Sb(),b.Sb())},directives:[x.a,P.c,i.a,r.a,z.a,z.d,z.f,z.c,q.f,q.c,K.a,i.b],styles:['[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;position:relative}[_nghost-%COMP%]     speek-toolbar .mat-toolbar{background-color:transparent}[_nghost-%COMP%]:before{content:" ";width:100%;height:100%;position:absolute;background-image:url(/assets/descentralized.svg);background-position-x:center;background-position-y:center;background-repeat:no-repeat;background-size:210%;opacity:.1;transition:opacity .35s ease-in-out,background-size .4s ease}[_nghost-%COMP%]:hover:before{opacity:.08;background-size:260%}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]{letter-spacing:1.2px}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:12px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:120px;position:absolute;visibility:hidden;transition:visibility .6s ease-in-out}[_nghost-%COMP%]   .mat-form-field.active[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]   .mat-fab[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}']}),t})();const U=["local"],Y=["remote"],Z=["screen"];function tt(t,e){1&t&&(b.Rb(0),b.Ob(1,"speek-splash"),b.Qb())}let et=(()=>{class t{constructor(t,e,n,o,i,a,s,c,r){this.router=t,this.peer=e,this.share=n,this.route=o,this.drawer=i,this.stream=a,this.userRoom=s,this.userSetup=c,this.signaling=r,this.destroy=new S.a,this._audio=new k.a(!0),this.audio$=this._audio.asObservable(),this._video=new k.a(!0),this.video$=this._video.asObservable(),this._screen=new k.a(!0),this.screen$=this._screen.asObservable(),this.sender=M.a.short(),this.state=new S.a,this.onState=this.state.asObservable(),this.track=new S.a,this.onTrack=this.track.asObservable();const{code:l}=this.route.snapshot.params;this.code=l}ngOnInit(){this.signaling.on(T.a.Offer).pipe(Object(C.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new T.b(this.sender,this.code);this.signaling.send(T.a.CreateOrJoin,t),this.peer.onChange.subscribe(t=>{this.state.next(t.signalingState)}),this.peer.onCandidate.pipe(Object(C.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(C.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.screen=this.screenRef.nativeElement,this.signaling.on(T.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(T.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(L.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(M.f)(this.peer.connection)&&Object(M.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(n){throw new Error("handle-message: "+n)}})}makeChoice(t){return Object(L.a)(this,void 0,void 0,function*(){switch(t.type){case T.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case T.a.Answer:return this.peer.setRemote(t)}})}setScreen(t){}setLocal(t){this.stream.getStream({video:Object(D.d)(),audio:Object(D.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t,t.getTracks().forEach(t=>{console.log(t.getCapabilities()),console.log(t.getSettings()),console.log(t.getConstraints()),t.addEventListener("isolationchange",console.log)});const e=this.gotVoice(t),n=e.stream.getAudioTracks();this.peer.connection.addTrack(n.shift(),e.stream);const o=e.stream.getVideoTracks();this.peer.connection.addTrack(o.shift(),e.stream),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}gotVoice(t){var e;let n;const o=window.AudioContext||window.webkitAudioContext||!1;o?n=new o:alert("Sorry, but the Web Audio API is not supported by your browser.\n        Please, consider upgrading to the latest version or downloading\n        Google Chrome or Mozilla Firefox");const i=n.createMediaStreamSource(t),a=n.createMediaStreamDestination(),s=n.createDelay();s.delayTime.value=0,i.connect(s);const c=new w.a(n),{pitch:r=1.5}=null!==(e=this.userSetup.getStoredValue())&&void 0!==e?e:{};return c.setPitchOffset(r),s.connect(c.input),c.output.connect(a),a}sendOffer(t){this.signaling.send(T.a.Offer,new T.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}toggleScreen(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(w.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(P.b),b.Nb(E.a),b.Nb(m.k),b.Nb(P.a),b.Nb(m.g),b.Nb(E.e),b.Nb(_.a),b.Nb(_.b),b.Nb(E.c))},t.\u0275cmp=b.Hb({type:t,selectors:[["speek-room"]],viewQuery:function(t,e){if(1&t&&(b.Cc(U,1),b.Cc(Y,1),b.Cc(Z,1)),2&t){let t;b.nc(t=b.bc())&&(e.localRef=t.first),b.nc(t=b.bc())&&(e.remoteRef=t.first),b.nc(t=b.bc())&&(e.screenRef=t.first)}},decls:34,vars:16,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],[1,"brand-name","truncate"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"screen"],["screen",""],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","color","warn",1,"call-end",3,"disabled","click"]],template:function(t,e){1&t&&(b.Tb(0,"speek-toolbar"),b.Tb(1,"a",0),b.Tb(2,"mat-icon"),b.zc(3,"arrow_backward"),b.Sb(),b.Sb(),b.Tb(4,"span",1),b.zc(5),b.Sb(),b.Sb(),b.Ob(6,"video",2,3),b.Ob(8,"video",4,5),b.Tb(10,"mat-card"),b.Ob(11,"video",6,7),b.Tb(13,"mat-card-actions"),b.Tb(14,"button",8),b.ac("click",function(){return e.toggleAudio()}),b.Tb(15,"mat-icon"),b.zc(16),b.fc(17,"async"),b.Sb(),b.Sb(),b.Tb(18,"button",8),b.ac("click",function(){return e.toggleVideo()}),b.Tb(19,"mat-icon"),b.zc(20),b.fc(21,"async"),b.Sb(),b.Sb(),b.Tb(22,"button",8),b.ac("click",function(){return e.toggleScreen()}),b.Tb(23,"mat-icon"),b.zc(24),b.fc(25,"async"),b.Sb(),b.Tb(26,"mat-icon"),b.zc(27,"screen_share"),b.Sb(),b.Sb(),b.Sb(),b.Sb(),b.xc(28,tt,2,0,"ng-container",9),b.fc(29,"async"),b.Tb(30,"button",10),b.ac("click",function(){return e.hangup()}),b.fc(31,"async"),b.Tb(32,"mat-icon"),b.zc(33,"call_end"),b.Sb(),b.Sb()),2&t&&(b.Bb(5),b.Ac(e.code),b.Bb(11),b.Ac(b.gc(17,6,e.audio$)?"mic":"mic_off"),b.Bb(4),b.Ac(b.gc(21,8,e.video$)?"videocam":"videocam_off"),b.Bb(4),b.Ac(b.gc(25,10,e.screen$)?"screen_share":"stop_screen_share"),b.Bb(4),b.jc("ngIf","stable"!=b.gc(29,12,e.onState)),b.Bb(2),b.jc("disabled","stable"!=b.gc(31,14,e.onState)))},directives:[x.a,P.c,i.a,r.a,z.a,z.b,i.b,d.k,$.a],pipes:[d.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#090909}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top;flex:1}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;position:absolute;min-width:220px;width:25%;bottom:16px;right:0}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px}"]}),t})(),nt=(()=>{class t{constructor(t,e){this.userSetup=t,this._router=e}canDeactivate(t,e,n,o){return t.form.valid}canActivate(t,e){var n;const o=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return o.pitch||this.userSetup.store(Object.assign(o,{pitch:0})),!0}}return t.\u0275fac=function(e){return new(e||t)(b.Xb(_.b),b.Xb(P.b))},t.\u0275prov=b.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ot=n("LRne"),it=n("0IaG");let at=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,n,o){var i;const a=null===(i=t.state)||void 0===i?void 0:i.value;return"connected"===a||"connecting"===a?this._dialog.open(m.b,{data:{header:"Finalizar chamada",body:"\n        Voc\xea ainda est\xe1 conectado.\n        Cancele para continuar na\n        chamada ou encerre confirmando\n      "}}).afterClosed():Object(ot.a)(!0)}canActivate(t,e){var n;const o=t.paramMap.get("code");if(M.a.isValid(o)){const t=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return t.pitch||this.userSetup.update(Object.assign(Object.assign({},t),{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(b.Xb(it.b),b.Xb(_.b))},t.\u0275prov=b.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=n("EY2u");let ct=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,n,o){var i;const a=this._dialog.open(m.b,{data:{header:"Finalizar chamada",body:"Cancele para continuar na chamada ou encerre confirmando"}});return(null===(i=t.localStream)||void 0===i?void 0:i.active)?a.afterClosed():st.a}canActivate(t,e){var n;const o=t.paramMap.get("code");if(M.a.isValid(o)){const t=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return t.pitch||this.userSetup.store(Object.assign(t,{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(b.Xb(it.b),b.Xb(_.b))},t.\u0275prov=b.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),rt=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},imports:[[P.d.forChild([{path:"",component:W},{path:"create",component:R},{path:"dialup",component:v},{path:"invite",canActivate:[nt],component:A},{path:"invite/:code",canActivate:[nt],component:A},{path:":code",redirectTo:":code/meet"},{path:":code/room",canActivate:[ct],canDeactivate:[ct],component:et},{path:":code/meet",canActivate:[at],canDeactivate:[at],component:X}])],P.d]}),t})(),lt=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},imports:[[d.c]]}),t})();var dt=n("0MNC"),bt=n("+rOU"),ht=n("u47x");let ut=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},providers:[G],imports:[[d.c,ht.a,lt,bt.f,m.l,m.e,m.p,m.a,m.j,h,m.h,dt.c,m.d,m.i,m.m,u.a,p.b,l.o,rt]]}),t})()}}]);