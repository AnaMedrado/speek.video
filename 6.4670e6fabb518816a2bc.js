(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{zljH:function(t,e,n){"use strict";n.r(e),n.d(e,"PageModule",function(){return ct});var o=n("W5dm"),i=n("UXJo"),a=n("3Pt+"),s=n("7+mf"),c=n("fXoL");const r=["localAudio"];let l=(()=>{class t{constructor(t){this._fb=t,this.form=this._fb.group({sendTones:[{value:"",disabled:!0}],duration:[500],gap:[50],tones:["1199##9,6633221,9966332,9966332,1199##9,6633221"]}),this.gap=new a.d(50),this.duration=new a.d(500)}onClicked(t){console.log(t)}call(){console.log(this.audio)}sendTones(){}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(a.c))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-dialup"]],viewQuery:function(t,e){if(1&t&&(c.Bc(r,1),c.Bc(s.b,1)),2&t){let t;c.mc(t=c.ac())&&(e.audioRef=t.first),c.mc(t=c.ac())&&(e.dialPad=t.first)}},decls:0,vars:0,template:function(t,e){},styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   section[_ngcontent-%COMP%]{padding:0 12px;display:flex;justify-content:space-between;align-items:center}"]}),t})();var b=n("Kj3r"),d=n("1G5W"),h=n("GhD8"),u=n("qFsG"),m=n("0Z/k"),p=n("XNiG"),g=n("2Vo4"),f=n("bYjQ"),v=n("WGO7"),O=n("tyNb"),y=n("CTL+"),_=n("bTqV"),C=n("NFeN"),M=n("a7DZ"),w=n("Wp6s"),P=n("ofXK"),S=n("kmnG");const k=function(t){return{hide:t}};let x=(()=>{class t{constructor(t,e,n){this._router=t,this._route=e,this._userRoom=n,this._destroy=new p.a,this.comeInOut=new g.a(!1),this.form=new a.g({code:new a.d("",[a.p.required,a.p.pattern(v.a.regex)])})}get enter(){return this.comeInOut.value}onPaste(t){if(t.stopPropagation(),t.preventDefault(),"clipboardData"in t||"clipboardData"in window){const e=(t.clipboardData||window.clipboardData).getData("Text"),n=v.a.getFromText(e);let o;(o=null==n?void 0:n.shift())&&this.code.patchValue(o),t.target.blur()}}get code(){return this.form.get("code")}ngOnInit(){const{code:t}=this._route.snapshot.params;this.form.valueChanges.pipe(Object(b.a)(600),Object(d.a)(this._destroy)).subscribe(()=>this.onCodeChange()),this.form.patchValue({code:null!=t?t:""})}onCodeChange(){if(this.form.valid){const t=this.code.value;setTimeout(()=>this.comeInOut.next(!0),400),this._userRoom.update(f.c.fromJson(this.form.value)),setTimeout(()=>this._router.navigate(["/",t,"meet"]),2400)}}ngOnDestroy(){this.stream&&Object(m.b)(this.stream),this._destroy.next(),this._destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(O.b),c.Mb(O.a),c.Mb(h.a))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-invite"]],viewQuery:function(t,e){if(1&t&&c.Bc(u.a,1),2&t){let t;c.mc(t=c.ac())&&(e.input=t.first)}},hostVars:2,hostBindings:function(t,e){1&t&&c.Zb("paste",function(t){return e.onPaste(t)},!1,c.pc),2&t&&c.Eb("zoom",e.enter)},decls:19,vars:9,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button","","tabindex","-1"],[1,"brand-name"],[3,"opened"],[3,"ngClass"],[3,"formGroup"],["appearance","outline","color","accent"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","autocomplete","off","formControlName","code"]],template:function(t,e){1&t&&(c.Sb(0,"speek-toolbar"),c.Sb(1,"a",0),c.Sb(2,"mat-icon"),c.yc(3,"arrow_backward"),c.Rb(),c.Rb(),c.Sb(4,"span",1),c.yc(5,"convidado"),c.Rb(),c.Rb(),c.Nb(6,"speek-door",2),c.ec(7,"async"),c.Sb(8,"mat-card",3),c.ec(9,"async"),c.Sb(10,"form",4),c.Sb(11,"mat-form-field",5),c.Sb(12,"mat-label"),c.yc(13,"Entre com a chave da reuni\xe3o"),c.Rb(),c.Nb(14,"input",6),c.Sb(15,"mat-hint"),c.yc(16,"Caso n\xe3o tenha, pe\xe7a ao seu anfitri\xe3o"),c.Rb(),c.Sb(17,"mat-error"),c.yc(18,"Chave inv\xe1lida"),c.Rb(),c.Rb(),c.Rb(),c.Rb()),2&t&&(c.Bb(6),c.ic("opened",c.fc(7,3,e.comeInOut)),c.Bb(2),c.ic("ngClass",c.kc(7,k,c.fc(9,5,e.comeInOut))),c.Bb(2),c.ic("formGroup",e.form))},directives:[y.a,O.c,_.a,C.a,M.a,w.a,P.i,a.q,a.m,a.h,S.c,S.g,u.a,a.b,a.l,a.f,S.f,S.b],pipes:[P.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transition:transform 3s ease-in-out}.zoom[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transform:scale(5)}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}"]}),t})();var R=n("Qu3c");const T=["tip"],j=function(t){return{hide:t}};let B=(()=>{class t{constructor(t,e){this._router=t,this._userRoom=e,this.url="https://speek.video/#/invite",this.comeInOut=new g.a(!1),this.form=new a.g({code:new a.d("",[a.p.required,a.p.pattern(v.a.regex)])})}get enter(){return this.comeInOut.value}get code(){return this.form.get("code")}ngOnInit(){const t=v.a.long();this.code.setValue(t),this.url=`${this.url}/${t}`}ngAfterViewInit(){this.tip&&(this.showTip=window.setTimeout(()=>{this.tip.show(),this.hideTip=window.setTimeout(()=>{this.tip.hide(),this.tip.message="Copiado",window.clearTimeout(this.hideTip)},2250),window.clearTimeout(this.showTip)},750))}onCopy(t){t.show(),this._userRoom.update(f.c.fromJson(this.form.value)),setTimeout(()=>t.hide(),750),setTimeout(()=>this.comeInOut.next(!0),1e3),setTimeout(()=>this._router.navigate(["/",this.code.value,"meet"]),3e3)}ngOnDestroy(){this.toggleTip&&window.clearInterval(this.toggleTip)}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(O.b),c.Mb(h.a))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-create"]],viewQuery:function(t,e){if(1&t&&c.Bc(T,1),2&t){let t;c.mc(t=c.ac())&&(e.tip=t.first)}},hostVars:2,hostBindings:function(t,e){2&t&&c.Eb("zoom",e.enter)},decls:21,vars:10,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],[1,"brand-name"],[3,"opened"],[3,"ngClass"],[3,"formGroup"],["appearance","outline","color","accent"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","formControlName","code"],["matSuffix","","type","button","mat-icon-button","",3,"cdkCopyToClipboard","click"],["matTooltip","Copiar chave","matTooltipPosition","above"],["tip","matTooltip"]],template:function(t,e){if(1&t){const t=c.Tb();c.Sb(0,"speek-toolbar"),c.Sb(1,"a",0),c.Sb(2,"mat-icon"),c.yc(3,"arrow_backward"),c.Rb(),c.Rb(),c.Sb(4,"span",1),c.yc(5,"come\xe7ar"),c.Rb(),c.Rb(),c.Nb(6,"speek-door",2),c.ec(7,"async"),c.Sb(8,"mat-card",3),c.ec(9,"async"),c.Sb(10,"form",4),c.Sb(11,"mat-form-field",5),c.Sb(12,"mat-label"),c.yc(13,"Copie sua chave clicando ao lado"),c.Rb(),c.Nb(14,"input",6),c.Sb(15,"mat-hint"),c.yc(16,"Voc\xea precisa copiar a chave antes de entrar"),c.Rb(),c.Sb(17,"button",7),c.Zb("click",function(){c.qc(t);const n=c.nc(19);return e.onCopy(n)}),c.Sb(18,"mat-icon",8,9),c.yc(20," content_copy "),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Rb()}2&t&&(c.Bb(6),c.ic("opened",c.fc(7,4,e.comeInOut)),c.Bb(2),c.ic("ngClass",c.kc(8,j,c.fc(9,6,e.comeInOut))),c.Bb(2),c.ic("formGroup",e.form),c.Bb(7),c.ic("cdkCopyToClipboard",e.url))},directives:[y.a,O.c,_.a,C.a,M.a,w.a,P.i,a.q,a.m,a.h,S.c,S.g,u.a,a.b,a.l,a.f,S.f,_.b,S.h,i.a,R.a],pipes:[P.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transition:transform 3s ease-in-out}.zoom[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transform:scale(5)}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}@keyframes flicker-1{0%,to{color:#fff}41.99%{color:#fff}42%{color:#00bcd4}44.80%{color:#00bcd4}45.01%{color:#fff}47.99%{color:#fff}48%{color:#00bcd4}49%{color:#00bcd4}49.01%{color:#fff}}"]}),t})();var I=n("mrSG"),V=n("6vI4"),A=n("597B"),N=n("oNgS");let z=(()=>{class t{transform(t){var e;return null!==(e=A.i[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=c.Lb({name:"peerStateBadge",type:t,pure:!0}),t})(),D=(()=>{class t{transform(t){var e;return null!==(e=A.h[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=c.Lb({name:"peerSignalBadge",type:t,pure:!0}),t})();const E=["local"],L=["remote"];function G(t,e){if(1&t&&(c.Qb(0),c.Nb(1,"speek-splash",12),c.ec(2,"peerSignalBadge"),c.ec(3,"async"),c.Pb()),2&t){const t=c.dc();c.Bb(1),c.ic("message",c.fc(2,1,c.fc(3,3,t.signal$)))}}const $=function(t,e){return{enabled:t,disabled:e}};let Z=(()=>{class t{constructor(t,e,n,o,i,a){this.router=t,this.route=e,this.peer=n,this.stream=o,this.transfer=i,this.signaling=a,this.destroy=new p.a,this._audio=new g.a(!0),this.audio=this._audio.asObservable(),this._video=new g.a(!0),this.video=this._video.asObservable(),this.sender=v.a.short(),this.signal=new g.a("closed"),this.signal$=this.signal.asObservable(),this.state=new g.a("disconnected"),this.state$=this.state.asObservable(),this.track=new p.a,this.onTrack=this.track.asObservable(),this.status=new p.a,this.status$=this.status.asObservable();const{code:s}=this.route.snapshot.params;this.code=s}ngOnInit(){this.signaling.on(f.a.Offer).pipe(Object(d.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new f.b(this.sender,this.code);this.signaling.send(f.a.CreateOrJoin,t),this.peer.onSignal.subscribe(t=>{this.signal.next(t)}),this.peer.createChannel("channel").then(t=>{}),this.peer.onState.subscribe(t=>{console.log("state: ",t),this.state.next(t),"connected"===t&&console.log("CONNECTED"),"disconnected"===t&&(this.remote.srcObject=null)}),this.peer.onCandidate.pipe(Object(d.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(d.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})}),this.peer.onNegotiationNeeded.subscribe(({target:t})=>{console.log("needed: ",t),this.status.next(t.connectionState)}),this.peer.onWarning.subscribe(({description:t})=>{console.log("needed: ",t),this.status.next(t)})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.signaling.on(f.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(f.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(I.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(v.f)(this.peer.connection)&&Object(v.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(n){throw new Error("handle-message: "+n)}})}makeChoice(t){return Object(I.a)(this,void 0,void 0,function*(){switch(t.type){case f.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case f.a.Answer:return this.peer.setRemote(t)}})}setLocal(t){this.stream.getStream({video:Object(V.d)(),audio:Object(V.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t;const e=t.getAudioTracks();this.peer.connection.addTrack(e.shift(),t);const n=t.getVideoTracks();this.peer.connection.addTrack(n.shift(),t),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}sendOffer(t){this.signaling.send(f.a.Offer,new f.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}openTransfer(){this.transfer.open(this.peer.connection).subscribe(t=>{console.log(t)})}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(m.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(O.b),c.Mb(O.a),c.Mb(A.a),c.Mb(A.e),c.Mb(s.j),c.Mb(A.c))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-meet"]],viewQuery:function(t,e){if(1&t&&(c.Bc(E,1),c.Bc(L,1)),2&t){let t;c.mc(t=c.ac())&&(e.localRef=t.first),c.mc(t=c.ac())&&(e.remoteRef=t.first)}},decls:38,vars:32,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],[1,"meeting-room"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"local",3,"ngClass"],["local",""],["aria-live","polite"],["type","button","mat-button","",3,"click"],["type","button","aria-label","Transferir dados","mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","aria-label","Encerrar liga\xe7\xe3o","color","warn",1,"call-end",3,"disabled","click"],[1,"room-code"],["width","200px",3,"message"]],template:function(t,e){1&t&&(c.Sb(0,"speek-toolbar"),c.Sb(1,"a",0),c.Sb(2,"mat-icon"),c.yc(3,"arrow_backward"),c.Rb(),c.Rb(),c.Sb(4,"span"),c.yc(5),c.ec(6,"peerStateBadge"),c.ec(7,"async"),c.Rb(),c.Rb(),c.Sb(8,"section",1),c.Nb(9,"video",2,3),c.Rb(),c.Sb(11,"mat-card"),c.Nb(12,"video",4,5),c.ec(14,"async"),c.ec(15,"async"),c.Sb(16,"mat-card-actions",6),c.Sb(17,"button",7),c.Zb("click",function(){return e.toggleAudio()}),c.ec(18,"async"),c.Sb(19,"mat-icon"),c.yc(20),c.ec(21,"async"),c.Rb(),c.Rb(),c.Sb(22,"button",7),c.Zb("click",function(){return e.toggleVideo()}),c.ec(23,"async"),c.Sb(24,"mat-icon"),c.yc(25),c.ec(26,"async"),c.Rb(),c.Rb(),c.Sb(27,"button",8),c.Zb("click",function(){return e.openTransfer()}),c.Sb(28,"mat-icon"),c.yc(29,"swap_horiz"),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.wc(30,G,4,5,"ng-container",9),c.ec(31,"async"),c.Sb(32,"button",10),c.Zb("click",function(){return e.hangup()}),c.ec(33,"async"),c.Sb(34,"mat-icon"),c.yc(35,"call_end"),c.Rb(),c.Rb(),c.Sb(36,"span",11),c.yc(37),c.Rb()),2&t&&(c.Bb(5),c.Ac(" ",c.fc(6,9,c.fc(7,11,e.state$))," "),c.Bb(7),c.ic("ngClass",c.lc(29,$,!0===c.fc(14,13,e.video),!1===c.fc(15,15,e.video))),c.Bb(5),c.Cb("aria-label",c.fc(18,17,e.audio)?"Desabilitar \xe1udio":"Habilitar \xe1udio"),c.Bb(3),c.zc(c.fc(21,19,e.audio)?"mic":"mic_off"),c.Bb(2),c.Cb("aria-label",c.fc(23,21,e.video)?"Desabilitar v\xeddeo":"Habilitar v\xeddeo"),c.Bb(3),c.zc(c.fc(26,23,e.video)?"videocam":"videocam_off"),c.Bb(5),c.ic("ngIf","stable"!=c.fc(31,25,e.signal$)),c.Bb(2),c.ic("disabled","connected"!=c.fc(33,27,e.state$)),c.Bb(5),c.zc(e.code))},directives:[y.a,O.c,_.a,C.a,w.a,P.i,w.b,_.b,P.k,N.a],pipes:[z,P.b,D],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#121212}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]{height:100%;position:relative}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   speek-lamp[_ngcontent-%COMP%], [_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{flex:1;width:100%;height:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;border-bottom-right-radius:0;border-top-right-radius:0;position:absolute;min-width:200px;max-width:260px;width:25%;bottom:24px;right:0;z-index:2}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.enabled[_ngcontent-%COMP%]{animation:swing-in-bottom-fwd .5s cubic-bezier(.175,.885,.32,1.275) both}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.disabled[_ngcontent-%COMP%]{animation:swing-out-bottom-bck .45s cubic-bezier(.6,-.28,.735,.045) both}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;opacity:.8}[_nghost-%COMP%]   .room-code[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;opacity:.3}@keyframes swing-in-bottom-fwd{0%{transform:rotateX(100deg);transform-origin:bottom;opacity:0}to{transform:rotateX(0);transform-origin:bottom;opacity:1}}@keyframes swing-out-bottom-bck{0%{transform:rotateX(0);transform-origin:bottom;opacity:1}to{transform:rotateX(100deg);transform-origin:bottom;opacity:0}}"]}),t})();var W=n("MutI"),J=n("f0Cb");let Q=(()=>{class t{constructor(t,e){this._router=t,this._share=e,this.destroy=new p.a}share(){this._share.open().pipe(Object(d.a)(this.destroy)).subscribe(t=>{console.log(t)})}go(t){t&&this._router.navigate(["/",t])}ngOnDestroy(){this.destroy.next(),this.destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(O.b),c.Mb(s.g))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-home"]],decls:30,vars:0,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],["svgIcon","speek-logo"],[1,"brand-name"],["mat-card-subtitle",""],["mat-list-item","","routerLink","/create","aria-label","Iniciar conversa"],["mat-list-item","","routerLink","/invite","aria-label","Acessar conversa"],["mat-list-item","","routerLink","/setting","aria-label","Configura\xe7\xf5es"],["mat-fab","","aria-label","Compartilhar",3,"click"]],template:function(t,e){1&t&&(c.Sb(0,"speek-toolbar"),c.Sb(1,"a",0),c.Nb(2,"mat-icon",1),c.Rb(),c.Sb(3,"span",2),c.yc(4,"speek"),c.Rb(),c.Rb(),c.Sb(5,"mat-card"),c.Sb(6,"mat-card-header"),c.Sb(7,"h1",3),c.yc(8,"Como quer come\xe7ar?"),c.Rb(),c.Rb(),c.Sb(9,"mat-card-content"),c.Sb(10,"mat-nav-list"),c.Sb(11,"a",4),c.Sb(12,"mat-icon"),c.yc(13,"voice_chat"),c.Rb(),c.Sb(14,"span"),c.yc(15,"Iniciar conversa"),c.Rb(),c.Rb(),c.Sb(16,"a",5),c.Sb(17,"mat-icon"),c.yc(18,"mark_chat_unread"),c.Rb(),c.Sb(19,"span"),c.yc(20,"Acessar conversa"),c.Rb(),c.Rb(),c.Nb(21,"mat-divider"),c.Sb(22,"a",6),c.Sb(23,"mat-icon"),c.yc(24,"settings"),c.Rb(),c.Sb(25,"span"),c.yc(26,"Configura\xe7\xf5es"),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Sb(27,"button",7),c.Zb("click",function(){return e.share()}),c.Sb(28,"mat-icon"),c.yc(29,"share"),c.Rb(),c.Rb())},directives:[y.a,O.c,_.a,C.a,w.a,w.d,w.f,w.c,W.f,W.c,J.a,_.b],styles:['[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;position:relative}[_nghost-%COMP%]     speek-toolbar .mat-toolbar{background-color:transparent}[_nghost-%COMP%]:before{content:" ";width:100%;height:100%;position:absolute;background-image:url(/assets/descentralized.svg);background-position-x:center;background-position-y:center;background-repeat:no-repeat;background-size:210%;opacity:.1;transition:opacity .35s ease-in-out,background-size .4s ease}[_nghost-%COMP%]:hover:before{opacity:.08;background-size:260%}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]{letter-spacing:1.2px}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:12px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:120px;position:absolute;visibility:hidden;transition:visibility .6s ease-in-out}[_nghost-%COMP%]   .mat-form-field.active[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]   .mat-fab[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}']}),t})();const q=["local"],F=["remote"],X=["screen"];function K(t,e){1&t&&(c.Qb(0),c.Nb(1,"speek-splash"),c.Pb())}let H=(()=>{class t{constructor(t,e,n,o,i,a,s,c,r){this.router=t,this.peer=e,this.share=n,this.route=o,this.drawer=i,this.stream=a,this.userRoom=s,this.userSetup=c,this.signaling=r,this.destroy=new p.a,this._audio=new g.a(!0),this.audio$=this._audio.asObservable(),this._video=new g.a(!0),this.video$=this._video.asObservable(),this._screen=new g.a(!0),this.screen$=this._screen.asObservable(),this.sender=v.a.short(),this.state=new p.a,this.onState=this.state.asObservable(),this.track=new p.a,this.onTrack=this.track.asObservable();const{code:l}=this.route.snapshot.params;this.code=l}ngOnInit(){this.signaling.on(f.a.Offer).pipe(Object(d.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new f.b(this.sender,this.code);this.signaling.send(f.a.CreateOrJoin,t),this.peer.onChange.subscribe(t=>{this.state.next(t.signalingState)}),this.peer.onCandidate.pipe(Object(d.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(d.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.screen=this.screenRef.nativeElement,this.signaling.on(f.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(f.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(I.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(v.f)(this.peer.connection)&&Object(v.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(n){throw new Error("handle-message: "+n)}})}makeChoice(t){return Object(I.a)(this,void 0,void 0,function*(){switch(t.type){case f.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case f.a.Answer:return this.peer.setRemote(t)}})}setScreen(t){}setLocal(t){this.stream.getStream({video:Object(V.d)(),audio:Object(V.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t,t.getTracks().forEach(t=>{console.log(t.getCapabilities()),console.log(t.getSettings()),console.log(t.getConstraints()),t.addEventListener("isolationchange",console.log)});const e=this.gotVoice(t),n=e.stream.getAudioTracks();this.peer.connection.addTrack(n.shift(),e.stream);const o=e.stream.getVideoTracks();this.peer.connection.addTrack(o.shift(),e.stream),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}gotVoice(t){var e;let n;const o=window.AudioContext||window.webkitAudioContext||!1;o?n=new o:alert("Sorry, but the Web Audio API is not supported by your browser.\n        Please, consider upgrading to the latest version or downloading\n        Google Chrome or Mozilla Firefox");const i=n.createMediaStreamSource(t),a=n.createMediaStreamDestination(),s=n.createDelay();s.delayTime.value=0,i.connect(s);const c=new m.a(n),{pitch:r=1.5}=null!==(e=this.userSetup.getStoredValue())&&void 0!==e?e:{};return c.setPitchOffset(r),s.connect(c.input),c.output.connect(a),a}sendOffer(t){this.signaling.send(f.a.Offer,new f.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}toggleScreen(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(m.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(O.b),c.Mb(A.a),c.Mb(s.g),c.Mb(O.a),c.Mb(s.e),c.Mb(A.e),c.Mb(h.a),c.Mb(h.b),c.Mb(A.c))},t.\u0275cmp=c.Gb({type:t,selectors:[["speek-room"]],viewQuery:function(t,e){if(1&t&&(c.Bc(q,1),c.Bc(F,1),c.Bc(X,1)),2&t){let t;c.mc(t=c.ac())&&(e.localRef=t.first),c.mc(t=c.ac())&&(e.remoteRef=t.first),c.mc(t=c.ac())&&(e.screenRef=t.first)}},decls:34,vars:16,consts:[["routerLink","/","aria-label","P\xe1gina inicial","mat-icon-button",""],[1,"brand-name","truncate"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"screen"],["screen",""],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","color","warn",1,"call-end",3,"disabled","click"]],template:function(t,e){1&t&&(c.Sb(0,"speek-toolbar"),c.Sb(1,"a",0),c.Sb(2,"mat-icon"),c.yc(3,"arrow_backward"),c.Rb(),c.Rb(),c.Sb(4,"span",1),c.yc(5),c.Rb(),c.Rb(),c.Nb(6,"video",2,3),c.Nb(8,"video",4,5),c.Sb(10,"mat-card"),c.Nb(11,"video",6,7),c.Sb(13,"mat-card-actions"),c.Sb(14,"button",8),c.Zb("click",function(){return e.toggleAudio()}),c.Sb(15,"mat-icon"),c.yc(16),c.ec(17,"async"),c.Rb(),c.Rb(),c.Sb(18,"button",8),c.Zb("click",function(){return e.toggleVideo()}),c.Sb(19,"mat-icon"),c.yc(20),c.ec(21,"async"),c.Rb(),c.Rb(),c.Sb(22,"button",8),c.Zb("click",function(){return e.toggleScreen()}),c.Sb(23,"mat-icon"),c.yc(24),c.ec(25,"async"),c.Rb(),c.Sb(26,"mat-icon"),c.yc(27,"screen_share"),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.wc(28,K,2,0,"ng-container",9),c.ec(29,"async"),c.Sb(30,"button",10),c.Zb("click",function(){return e.hangup()}),c.ec(31,"async"),c.Sb(32,"mat-icon"),c.yc(33,"call_end"),c.Rb(),c.Rb()),2&t&&(c.Bb(5),c.zc(e.code),c.Bb(11),c.zc(c.fc(17,6,e.audio$)?"mic":"mic_off"),c.Bb(4),c.zc(c.fc(21,8,e.video$)?"videocam":"videocam_off"),c.Bb(4),c.zc(c.fc(25,10,e.screen$)?"screen_share":"stop_screen_share"),c.Bb(4),c.ic("ngIf","stable"!=c.fc(29,12,e.onState)),c.Bb(2),c.ic("disabled","stable"!=c.fc(31,14,e.onState)))},directives:[y.a,O.c,_.a,C.a,w.a,w.b,_.b,P.k,N.a],pipes:[P.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#090909}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top;flex:1}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;position:absolute;min-width:220px;width:25%;bottom:16px;right:0}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px}"]}),t})(),Y=(()=>{class t{constructor(t,e){this.userSetup=t,this._router=e}canDeactivate(t,e,n,o){return t.form.valid}canActivate(t,e){var n;const o=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return o.pitch||this.userSetup.store(Object.assign(o,{pitch:0})),!0}}return t.\u0275fac=function(e){return new(e||t)(c.Wb(h.b),c.Wb(O.b))},t.\u0275prov=c.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var U=n("LRne"),tt=n("0IaG");let et=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,n,o){var i;const a=null===(i=t.state)||void 0===i?void 0:i.value;return"connected"===a||"connecting"===a?this._dialog.open(s.a,{data:{header:"Finalizar chamada",body:"\n        Voc\xea ainda est\xe1 conectado.\n        Cancele para continuar na\n        chamada ou encerre confirmando\n      "}}).afterClosed():Object(U.a)(!0)}canActivate(t,e){var n;const o=t.paramMap.get("code");if(v.a.isValid(o)){const t=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return t.pitch||this.userSetup.update(Object.assign(Object.assign({},t),{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(c.Wb(tt.b),c.Wb(h.b))},t.\u0275prov=c.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var nt=n("EY2u");let ot=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,n,o){var i;const a=this._dialog.open(s.a,{data:{header:"Finalizar chamada",body:"Cancele para continuar na chamada ou encerre confirmando"}});return(null===(i=t.localStream)||void 0===i?void 0:i.active)?a.afterClosed():nt.a}canActivate(t,e){var n;const o=t.paramMap.get("code");if(v.a.isValid(o)){const t=null!==(n=this.userSetup.getStoredValue())&&void 0!==n?n:{};return t.pitch||this.userSetup.store(Object.assign(t,{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(c.Wb(tt.b),c.Wb(h.b))},t.\u0275prov=c.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),it=(()=>{class t{}return t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({factory:function(e){return new(e||t)},imports:[[O.d.forChild([{path:"",component:Q},{path:"create",component:B},{path:"dialup",component:l},{path:"invite",canActivate:[Y],component:x},{path:"invite/:code",canActivate:[Y],component:x},{path:":code",redirectTo:":code/meet"},{path:":code/room",canActivate:[ot],canDeactivate:[ot],component:H},{path:":code/meet",canActivate:[et],canDeactivate:[et],component:Z}])],O.d]}),t})();var at=n("0MNC"),st=n("u47x");let ct=(()=>{class t{}return t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({factory:function(e){return new(e||t)},providers:[z],imports:[[P.c,st.a,s.h,s.c,s.f,at.c,s.i,o.a,i.b,a.o,it]]}),t})()}}]);