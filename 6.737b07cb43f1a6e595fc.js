(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{zljH:function(t,e,o){"use strict";o.r(e),o.d(e,"PageModule",function(){return dt});var n=o("d3UM"),i=o("bTqV"),a=o("/t3+"),s=o("kmnG"),c=o("5RNC"),r=o("NFeN"),l=o("3Pt+"),b=o("ofXK"),d=o("fXoL");let h=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},imports:[[b.c,r.b,c.b,n.b,i.c,a.b,s.e,l.o],l.o]}),t})();var u=o("W5dm"),m=o("UXJo"),p=o("7+mf"),g=o("Qdhi");const f=["localAudio"];let v=(()=>{class t{constructor(t){this._fb=t,this.form=this._fb.group({sendTones:[{value:"",disabled:!0}],duration:[500],gap:[50],tones:["1199##9,6633221,9966332,9966332,1199##9,6633221"]}),this.gap=new l.d(50),this.duration=new l.d(500)}ngOnInit(){}onClicked(t){console.log(t)}call(){console.log(this.audio)}sendTones(){}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(l.c))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-dialup"]],viewQuery:function(t,e){if(1&t&&(d.Bc(f,1),d.Bc(p.c,1)),2&t){let t;d.nc(t=d.bc())&&(e.audioRef=t.first),d.nc(t=d.bc())&&(e.dialPad=t.first)}},decls:1,vars:0,consts:[[3,"onClick"]],template:function(t,e){1&t&&(d.Tb(0,"speek-dialpad",0),d.ac("onClick",function(t){return e.onClicked(t)}),d.Sb())},directives:[g.a],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   section[_ngcontent-%COMP%]{padding:0 12px;display:flex;justify-content:space-between;align-items:center}"]}),t})();var O=o("IVWJ"),_=o("GhD8"),y=o("0Z/k"),C=o("XNiG"),S=o("2Vo4"),w=o("tyNb"),k=o("CTL+"),T=o("Wp6s"),M=o("MutI"),P=o("f0Cb"),x=o("qFsG"),j=o("a7DZ");function I(t,e){if(1&t&&(d.Rb(0),d.Ob(1,"speek-door",8),d.Qb()),2&t){const t=d.ec();d.Bb(1),d.jc("comeInOut",t.comeInOut)("opened",t.form.valid)}}let N=(()=>{class t{constructor(t,e,o,n){this._fb=t,this._router=e,this._route=o,this.userSetup=n,this._destroy=new C.a,this.comeInOut=new S.a(!1),this.enter=!1,this.form=new O.a;const{code:i=""}=this._route.snapshot.params;this.form.patchValue({code:i}),console.log(i)}ngOnInit(){this.userSetup.getStoredValue()}ngAfterViewInit(){navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0}})}onSave(){this.form.valid&&(this.userSetup.store(this.form.value),this.form.markAsPristine(),this._router.navigate(["/","newcode"]),console.log(this.form.value))}onLogin(){this.form.code.valid?(this.comeInOut.next(!this.comeInOut.value),this.enter=!0,setTimeout(()=>{this._router.navigate(["/",this.form.code.value])},3e3)):(this.comeInOut.next(!this.comeInOut.value),this.comeInOut.next(!this.comeInOut.value))}ngOnDestroy(){this.stream&&Object(y.b)(this.stream),this._destroy.next(),this._destroy.complete()}onSubmit(){this.form.valid&&(this.userSetup.store(this.form.value),this._router.navigate(["/",this.form.code.value]))}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(l.c),d.Nb(w.b),d.Nb(w.a),d.Nb(_.b))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-invite"]],decls:25,vars:3,consts:[["routerLink","/","mat-icon-button","","tabindex","-1"],[1,"brand-name"],[4,"ngIf"],[3,"formGroup"],["mat-subheader",""],["appearance","outline","color","accent"],["matInput","","autofocus","","cdkFocusInitial","","autocomplete","off","tabindex","0","formControlName","code"],["type","button","mat-fab","",3,"disabled","click"],[3,"comeInOut","opened"]],template:function(t,e){1&t&&(d.Tb(0,"speek-toolbar"),d.Tb(1,"a",0),d.Tb(2,"mat-icon"),d.yc(3,"arrow_backward"),d.Sb(),d.Sb(),d.Tb(4,"span",1),d.yc(5,"convidado"),d.Sb(),d.Sb(),d.wc(6,I,2,2,"ng-container",2),d.Tb(7,"mat-card"),d.Tb(8,"form",3),d.Tb(9,"mat-card-content"),d.Tb(10,"mat-list"),d.Tb(11,"h3",4),d.yc(12,"Arraste para ajustar o tom da sua voz"),d.Sb(),d.Sb(),d.Ob(13,"mat-divider"),d.Tb(14,"mat-form-field",5),d.Tb(15,"mat-label"),d.yc(16,"Entre com a chave da reuni\xe3o"),d.Sb(),d.Ob(17,"input",6),d.Tb(18,"mat-hint"),d.yc(19,"Caso n\xe3o tenha, pe\xe7a ao seu anfitri\xe3o"),d.Sb(),d.Tb(20,"mat-error"),d.yc(21,"C\xf3digo inv\xe1lido"),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Tb(22,"button",7),d.ac("click",function(){return e.onSubmit()}),d.Tb(23,"mat-icon"),d.yc(24,"phone_forwarded"),d.Sb(),d.Sb()),2&t&&(d.Bb(6),d.jc("ngIf",e.form.valid),d.Bb(2),d.jc("formGroup",e.form),d.Bb(14),d.jc("disabled",e.form.invalid))},directives:[k.a,w.c,i.a,r.a,b.k,T.a,l.q,l.m,l.h,T.c,M.a,M.e,P.a,s.c,s.g,x.a,l.b,l.l,l.f,s.f,s.b,i.b,j.a],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{padding-bottom:4px;margin-bottom:0}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{position:absolute;visibility:hidden}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-fab[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}"]}),t})();var A=o("bYjQ"),V=o("WGO7"),B=o("Qu3c");const L=["tip"],R=function(t){return{hide:t}};let z=(()=>{class t{constructor(t,e){this._router=t,this._userRoom=e,this.url="https://speek.video/#/invite",this.comeInOut=new S.a(!1),this.form=new l.g({code:new l.d("",[l.p.required,l.p.pattern(V.a.regex)])})}get enter(){return this.comeInOut.value}get code(){return this.form.get("code")}ngOnInit(){const t=V.a.long();this.code.setValue(t),this.url=`${this.url}/${t}`}ngAfterViewInit(){this.tip&&(this.showTip=window.setTimeout(()=>{this.tip.show(),this.hideTip=window.setTimeout(()=>{this.tip.hide(),this.tip.message="Copiado",window.clearTimeout(this.hideTip)},2250),window.clearTimeout(this.showTip)},750))}onCopy(t){t.show(),this._userRoom.update(A.c.fromJson(this.form.value)),setTimeout(()=>t.hide(),750),setTimeout(()=>this.comeInOut.next(!0),1e3),setTimeout(()=>this._router.navigate(["/",this.code.value,"meet"]),3e3)}ngOnDestroy(){this.toggleTip&&window.clearInterval(this.toggleTip)}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(w.b),d.Nb(_.a))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-create"]],viewQuery:function(t,e){if(1&t&&d.Bc(L,1),2&t){let t;d.nc(t=d.bc())&&(e.tip=t.first)}},hostVars:2,hostBindings:function(t,e){2&t&&d.Fb("zoom",e.enter)},decls:21,vars:10,consts:[["routerLink","/","mat-icon-button",""],[1,"brand-name"],[3,"opened"],[3,"ngClass"],[3,"formGroup"],["appearance","outline","color","accent"],["matInput","","autofocus","","type","text","name","code","cdkFocusInitial","","spellcheck","false","formControlName","code"],["matSuffix","","type","button","mat-icon-button","",3,"cdkCopyToClipboard","click"],["matTooltip","Copiar chave","matTooltipPosition","above"],["tip","matTooltip"]],template:function(t,e){if(1&t){const t=d.Ub();d.Tb(0,"speek-toolbar"),d.Tb(1,"a",0),d.Tb(2,"mat-icon"),d.yc(3,"arrow_backward"),d.Sb(),d.Sb(),d.Tb(4,"span",1),d.yc(5,"come\xe7ar"),d.Sb(),d.Sb(),d.Ob(6,"speek-door",2),d.fc(7,"async"),d.Tb(8,"mat-card",3),d.fc(9,"async"),d.Tb(10,"form",4),d.Tb(11,"mat-form-field",5),d.Tb(12,"mat-label"),d.yc(13,"Copie sua chave clicando ao lado"),d.Sb(),d.Ob(14,"input",6),d.Tb(15,"mat-hint"),d.yc(16,"Voc\xea precisa copiar a chave antes de entrar"),d.Sb(),d.Tb(17,"button",7),d.ac("click",function(){d.qc(t);const o=d.oc(19);return e.onCopy(o)}),d.Tb(18,"mat-icon",8,9),d.yc(20," content_copy "),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Sb()}2&t&&(d.Bb(6),d.jc("opened",d.gc(7,4,e.comeInOut)),d.Bb(2),d.jc("ngClass",d.lc(8,R,d.gc(9,6,e.comeInOut))),d.Bb(2),d.jc("formGroup",e.form),d.Bb(7),d.jc("cdkCopyToClipboard",e.url))},directives:[k.a,w.c,i.a,r.a,j.a,T.a,b.i,l.q,l.m,l.h,s.c,s.g,x.a,l.b,l.l,l.f,s.f,i.b,s.h,m.a,B.a],pipes:[b.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center}[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transition:transform 3s ease-in-out}.zoom[_nghost-%COMP%]   speek-door[_ngcontent-%COMP%]{transform:scale(5)}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{visibility:visible;color:#fff;transition:visibility 1.5s ease-in-out,opacity 1.5s ease-in-out}[_nghost-%COMP%]   .mat-card.hide[_ngcontent-%COMP%]{visibility:hidden;opacity:0}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:300px;margin:10px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:flicker-1 2s linear infinite both}@keyframes flicker-1{0%,to{color:#fff}41.99%{color:#fff}42%{color:#00bcd4}44.80%{color:#00bcd4}45.01%{color:#fff}47.99%{color:#fff}48%{color:#00bcd4}49%{color:#00bcd4}49.01%{color:#fff}}"]}),t})();var E=o("mrSG"),D=o("6vI4"),G=o("1G5W"),$=o("597B"),J=o("oNgS");let H=(()=>{class t{transform(t){var e;return null!==(e=$.h[t])&&void 0!==e?e:t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=d.Mb({name:"peerStateBadge",type:t,pure:!0}),t})();const Q=["local"],X=["remote"];function F(t,e){1&t&&(d.Rb(0),d.Ob(1,"speek-splash",10),d.Qb())}let q=(()=>{class t{constructor(t,e,o,n,i,a,s,c,r){this.router=t,this.peer=e,this.share=o,this.route=n,this.drawer=i,this.stream=a,this.userRoom=s,this.userSetup=c,this.signaling=r,this.destroy=new C.a,this._audio=new S.a(!0),this.audio=this._audio.asObservable(),this._video=new S.a(!0),this.video=this._video.asObservable(),this.sender=V.a.short(),this.state=new C.a,this.state$=this.state.asObservable(),this.track=new C.a,this.onTrack=this.track.asObservable(),this.status=new C.a,this.status$=this.status.asObservable();const{code:l}=this.route.snapshot.params;this.code=l}ngOnInit(){this.signaling.on(A.a.Offer).pipe(Object(G.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new A.b(this.sender,this.code);this.signaling.send(A.a.CreateOrJoin,t),this.peer.onChange.subscribe(t=>{this.state.next(t.signalingState),this.status.next(t.connectionState)}),this.peer.onCandidate.pipe(Object(G.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(G.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})}),this.peer.onNegotiationNeeded.subscribe(({target:t})=>{console.log("needed: ",t),this.status.next(t.connectionState)}),this.peer.onWarning.subscribe(({description:t})=>{console.log("needed: ",t),this.status.next(t)})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.signaling.on(A.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(A.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(E.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(V.f)(this.peer.connection)&&Object(V.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(o){throw new Error("handle-message: "+o)}})}makeChoice(t){return Object(E.a)(this,void 0,void 0,function*(){switch(t.type){case A.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case A.a.Answer:return this.peer.setRemote(t)}})}setLocal(t){this.stream.getStream({video:Object(D.d)(),audio:Object(D.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t,t.getTracks().forEach(t=>{console.log(t.getCapabilities()),console.log(t.getSettings()),console.log(t.getConstraints()),t.addEventListener("isolationchange",console.log)});const e=t.getAudioTracks();this.peer.connection.addTrack(e.shift(),t);const o=t.getVideoTracks();this.peer.connection.addTrack(o.shift(),t),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}sendOffer(t){this.signaling.send(A.a.Offer,new A.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(y.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(w.b),d.Nb($.a),d.Nb(p.k),d.Nb(w.a),d.Nb(p.g),d.Nb($.e),d.Nb(_.a),d.Nb(_.b),d.Nb($.c))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-meet"]],viewQuery:function(t,e){if(1&t&&(d.Bc(Q,1),d.Bc(X,1)),2&t){let t;d.nc(t=d.bc())&&(e.localRef=t.first),d.nc(t=d.bc())&&(e.remoteRef=t.first)}},decls:31,vars:18,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],[1,"meeting-room"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","color","warn",1,"call-end",3,"disabled","click"],[1,"room-code"],["width","200px","message","Aguardando entrada do participante..."]],template:function(t,e){1&t&&(d.Tb(0,"speek-toolbar"),d.Tb(1,"a",0),d.Tb(2,"mat-icon"),d.yc(3,"arrow_backward"),d.Sb(),d.Sb(),d.Tb(4,"span"),d.yc(5),d.fc(6,"peerStateBadge"),d.fc(7,"async"),d.Sb(),d.Sb(),d.Tb(8,"section",1),d.Ob(9,"video",2,3),d.Sb(),d.Tb(11,"mat-card"),d.Ob(12,"video",4,5),d.Tb(14,"mat-card-actions"),d.Tb(15,"button",6),d.ac("click",function(){return e.toggleAudio()}),d.Tb(16,"mat-icon"),d.yc(17),d.fc(18,"async"),d.Sb(),d.Sb(),d.Tb(19,"button",6),d.ac("click",function(){return e.toggleVideo()}),d.Tb(20,"mat-icon"),d.yc(21),d.fc(22,"async"),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.wc(23,F,2,0,"ng-container",7),d.fc(24,"async"),d.Tb(25,"button",8),d.ac("click",function(){return e.hangup()}),d.fc(26,"async"),d.Tb(27,"mat-icon"),d.yc(28,"call_end"),d.Sb(),d.Sb(),d.Tb(29,"span",9),d.yc(30),d.Sb()),2&t&&(d.Bb(5),d.Ac(" ",d.gc(6,6,d.gc(7,8,e.state$))," "),d.Bb(12),d.zc(d.gc(18,10,e.audio)?"mic":"mic_off"),d.Bb(4),d.zc(d.gc(22,12,e.video)?"videocam":"videocam_off"),d.Bb(2),d.jc("ngIf","stable"!=d.gc(24,14,e.state$)),d.Bb(2),d.jc("disabled","stable"!=d.gc(26,16,e.state$)),d.Bb(5),d.zc(e.code))},directives:[k.a,w.c,i.a,r.a,T.a,T.b,i.b,b.k,J.a],pipes:[H,b.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#121212}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]{height:100%;position:relative}[_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   speek-lamp[_ngcontent-%COMP%], [_nghost-%COMP%]   .meeting-room[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{flex:1;width:100%;height:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;border-bottom-right-radius:0;border-top-right-radius:0;position:absolute;min-width:200px;max-width:260px;width:25%;bottom:24px;right:0;z-index:2}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px}[_nghost-%COMP%]   .room-code[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;opacity:.3}"]}),t})(),W=(()=>{class t{constructor(t,e){this._router=t,this._share=e,this.destroy=new C.a}share(){this._share.open().pipe(Object(G.a)(this.destroy)).subscribe(t=>{console.log(t)})}go(t){t&&this._router.navigate(["/",t])}ngOnDestroy(){this.destroy.next(),this.destroy.complete()}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(w.b),d.Nb(p.k))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-home"]],decls:30,vars:0,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],["svgIcon","speek-logo"],[1,"brand-name"],["mat-card-subtitle",""],["mat-list-item","","routerLink","/create","aria-label","Iniciar conversa"],["mat-list-item","","routerLink","/invite","aria-label","Acessar conversa"],["mat-list-item","","routerLink","/setting","aria-label","Configura\xe7\xf5es"],["mat-fab","","aria-label","Compartilhar",3,"click"]],template:function(t,e){1&t&&(d.Tb(0,"speek-toolbar"),d.Tb(1,"a",0),d.Ob(2,"mat-icon",1),d.Sb(),d.Tb(3,"span",2),d.yc(4,"speek"),d.Sb(),d.Sb(),d.Tb(5,"mat-card"),d.Tb(6,"mat-card-header"),d.Tb(7,"h1",3),d.yc(8,"Como quer come\xe7ar?"),d.Sb(),d.Sb(),d.Tb(9,"mat-card-content"),d.Tb(10,"mat-nav-list"),d.Tb(11,"a",4),d.Tb(12,"mat-icon"),d.yc(13,"voice_chat"),d.Sb(),d.Tb(14,"span"),d.yc(15,"Iniciar conversa"),d.Sb(),d.Sb(),d.Tb(16,"a",5),d.Tb(17,"mat-icon"),d.yc(18,"mark_chat_unread"),d.Sb(),d.Tb(19,"span"),d.yc(20,"Acessar conversa"),d.Sb(),d.Sb(),d.Ob(21,"mat-divider"),d.Tb(22,"a",6),d.Tb(23,"mat-icon"),d.yc(24,"settings"),d.Sb(),d.Tb(25,"span"),d.yc(26,"Configura\xe7\xf5es"),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Tb(27,"button",7),d.ac("click",function(){return e.share()}),d.Tb(28,"mat-icon"),d.yc(29,"share"),d.Sb(),d.Sb())},directives:[k.a,w.c,i.a,r.a,T.a,T.d,T.f,T.c,M.f,M.c,P.a,i.b],styles:['[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;position:relative}[_nghost-%COMP%]     speek-toolbar .mat-toolbar{background-color:transparent}[_nghost-%COMP%]:before{content:" ";width:100%;height:100%;position:absolute;background-image:url(/assets/descentralized.svg);background-position-x:center;background-position-y:center;background-repeat:no-repeat;background-size:200%;opacity:.16;transition:filter .25s ease-in-out,opacity .5s ease-in-out,background-size .4s ease-in-out}[_nghost-%COMP%]:hover:before{opacity:.06;background-size:360%}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]{letter-spacing:1.2px}[_nghost-%COMP%]   .mat-nav-list[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:12px}[_nghost-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:120px;position:absolute;visibility:hidden;transition:visibility .6s ease-in-out}[_nghost-%COMP%]   .mat-form-field.active[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]   .mat-fab[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}']}),t})();const K=["local"],U=["remote"],Y=["screen"];function Z(t,e){1&t&&(d.Rb(0),d.Ob(1,"speek-splash"),d.Qb())}let tt=(()=>{class t{constructor(t,e,o,n,i,a,s,c,r){this.router=t,this.peer=e,this.share=o,this.route=n,this.drawer=i,this.stream=a,this.userRoom=s,this.userSetup=c,this.signaling=r,this.destroy=new C.a,this._audio=new S.a(!0),this.audio$=this._audio.asObservable(),this._video=new S.a(!0),this.video$=this._video.asObservable(),this._screen=new S.a(!0),this.screen$=this._screen.asObservable(),this.sender=V.a.short(),this.state=new C.a,this.onState=this.state.asObservable(),this.track=new C.a,this.onTrack=this.track.asObservable();const{code:l}=this.route.snapshot.params;this.code=l}ngOnInit(){this.signaling.on(A.a.Offer).pipe(Object(G.a)(this.destroy)).subscribe(t=>this.handle(t));const t=new A.b(this.sender,this.code);this.signaling.send(A.a.CreateOrJoin,t),this.peer.onChange.subscribe(t=>{this.state.next(t.signalingState)}),this.peer.onCandidate.pipe(Object(G.a)(this.destroy)).subscribe(t=>{t&&this.sendOffer({ice:t})}),this.peer.onTrack.pipe(Object(G.a)(this.destroy)).subscribe(t=>{this.track.next(t),t&&(this.remote.srcObject=t,t.onremovetrack=t=>{this.remote.srcObject=null})})}ngAfterViewInit(){this.local=this.localRef.nativeElement,this.remote=this.remoteRef.nativeElement,this.screen=this.screenRef.nativeElement,this.signaling.on(A.a.Created).subscribe(t=>this.setLocal(t)),this.signaling.on(A.a.Joined).subscribe(t=>this.setLocal(t))}handle({data:t,sender:e}){return Object(E.a)(this,void 0,void 0,function*(){try{e!==this.sender&&(Object(V.f)(this.peer.connection)&&Object(V.e)(t.ice)&&this.peer.addCandidate(t.ice),t.sdp&&this.makeChoice(t.sdp))}catch(o){throw new Error("handle-message: "+o)}})}makeChoice(t){return Object(E.a)(this,void 0,void 0,function*(){switch(t.type){case A.a.Offer:return this.peer.createAnswer(t).then(t=>{this.sendOffer({sdp:t})});case A.a.Answer:return this.peer.setRemote(t)}})}setScreen(t){}setLocal(t){this.stream.getStream({video:Object(D.d)(),audio:Object(D.b)()}).then(t=>{this.local.muted=!0,this.localStream=t,this.local.srcObject=t,t.getTracks().forEach(t=>{console.log(t.getCapabilities()),console.log(t.getSettings()),console.log(t.getConstraints()),t.addEventListener("isolationchange",console.log)});const e=this.gotVoice(t),o=e.stream.getAudioTracks();this.peer.connection.addTrack(o.shift(),e.stream);const n=e.stream.getVideoTracks();this.peer.connection.addTrack(n.shift(),e.stream),this.peer.createOffer().then(t=>this.sendOffer({sdp:t}))})}gotVoice(t){var e;let o,n=window.AudioContext||window.webkitAudioContext||!1;n?o=new n:alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");const i=o.createMediaStreamSource(t),a=o.createMediaStreamDestination(),s=o.createDelay();s.delayTime.value=0,i.connect(s);const c=new y.a(o),{pitch:r=1.5}=null!==(e=this.userSetup.getStoredValue())&&void 0!==e?e:{};return c.setPitchOffset(r),s.connect(c.input),c.output.connect(a),a}sendOffer(t){this.signaling.send(A.a.Offer,new A.b(this.sender,this.code,t))}toggleAudio(){const t=!this._audio.getValue();this.localStream.getAudioTracks().forEach(e=>e.enabled=t),this._audio.next(t)}toggleVideo(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}toggleScreen(){const t=!this._video.getValue();this.localStream.getVideoTracks().forEach(e=>e.enabled=t),this._video.next(t)}hangup(){this.router.navigate(["/"])}ngOnDestroy(){var t;this.destroy.next(),this.destroy.complete(),this.localStream&&Object(y.b)(this.localStream),(null===(t=this.peer)||void 0===t?void 0:t.connection)&&console.log("close")}}return t.\u0275fac=function(e){return new(e||t)(d.Nb(w.b),d.Nb($.a),d.Nb(p.k),d.Nb(w.a),d.Nb(p.g),d.Nb($.e),d.Nb(_.a),d.Nb(_.b),d.Nb($.c))},t.\u0275cmp=d.Hb({type:t,selectors:[["speek-room"]],viewQuery:function(t,e){if(1&t&&(d.Bc(K,1),d.Bc(U,1),d.Bc(Y,1)),2&t){let t;d.nc(t=d.bc())&&(e.localRef=t.first),d.nc(t=d.bc())&&(e.remoteRef=t.first),d.nc(t=d.bc())&&(e.screenRef=t.first)}},decls:34,vars:16,consts:[["routerLink","/","aria-label","Home","mat-icon-button",""],[1,"brand-name","truncate"],["autoplay","","playsinline","","muted","",1,"remote"],["remote",""],["autoplay","","playsinline","","muted","",1,"screen"],["screen",""],["autoplay","","playsinline","","muted","",1,"local"],["local",""],["mat-button","",3,"click"],[4,"ngIf"],["mat-fab","","color","warn",1,"call-end",3,"disabled","click"]],template:function(t,e){1&t&&(d.Tb(0,"speek-toolbar"),d.Tb(1,"a",0),d.Tb(2,"mat-icon"),d.yc(3,"arrow_backward"),d.Sb(),d.Sb(),d.Tb(4,"span",1),d.yc(5),d.Sb(),d.Sb(),d.Ob(6,"video",2,3),d.Ob(8,"video",4,5),d.Tb(10,"mat-card"),d.Ob(11,"video",6,7),d.Tb(13,"mat-card-actions"),d.Tb(14,"button",8),d.ac("click",function(){return e.toggleAudio()}),d.Tb(15,"mat-icon"),d.yc(16),d.fc(17,"async"),d.Sb(),d.Sb(),d.Tb(18,"button",8),d.ac("click",function(){return e.toggleVideo()}),d.Tb(19,"mat-icon"),d.yc(20),d.fc(21,"async"),d.Sb(),d.Sb(),d.Tb(22,"button",8),d.ac("click",function(){return e.toggleScreen()}),d.Tb(23,"mat-icon"),d.yc(24),d.fc(25,"async"),d.Sb(),d.Tb(26,"mat-icon"),d.yc(27,"screen_share"),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.wc(28,Z,2,0,"ng-container",9),d.fc(29,"async"),d.Tb(30,"button",10),d.ac("click",function(){return e.hangup()}),d.fc(31,"async"),d.Tb(32,"mat-icon"),d.yc(33,"call_end"),d.Sb(),d.Sb()),2&t&&(d.Bb(5),d.zc(e.code),d.Bb(11),d.zc(d.gc(17,6,e.audio$)?"mic":"mic_off"),d.Bb(4),d.zc(d.gc(21,8,e.video$)?"videocam":"videocam_off"),d.Bb(4),d.zc(d.gc(25,10,e.screen$)?"screen_share":"stop_screen_share"),d.Bb(4),d.jc("ngIf","stable"!=d.gc(29,12,e.onState)),d.Bb(2),d.jc("disabled","stable"!=d.gc(31,14,e.onState)))},directives:[k.a,w.c,i.a,r.a,T.a,T.b,i.b,b.k,J.a],pipes:[b.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#090909}[_nghost-%COMP%]   .brand-name[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:100%;max-width:100%;max-height:100%;object-fit:cover;vertical-align:top;flex:1}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]{border-top-left-radius:12px;position:absolute;min-width:220px;width:25%;bottom:16px;right:0}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-card[_ngcontent-%COMP%]   video.remote[_ngcontent-%COMP%]{object-fit:cover}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{margin:0;display:flex;flex-direction:row;padding:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]   .mat-button-base[_ngcontent-%COMP%]{flex:1;padding:3px}[_nghost-%COMP%]   .call-end[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px}"]}),t})(),et=(()=>{class t{constructor(t,e){this.userSetup=t,this._router=e}canDeactivate(t,e,o,n){return t.form.valid}canActivate(t,e){var o;const n=null!==(o=this.userSetup.getStoredValue())&&void 0!==o?o:{};return n.pitch||this.userSetup.store(Object.assign(n,{pitch:0})),!0}}return t.\u0275fac=function(e){return new(e||t)(d.Xb(_.b),d.Xb(w.b))},t.\u0275prov=d.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ot=o("EY2u"),nt=o("0IaG");let it=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,o,n){var i;const a=this._dialog.open(p.b,{data:{header:"Finalizar chamada",body:"Cancele para continuar na chamada ou encerre confirmando"}});return(null===(i=t.localStream)||void 0===i?void 0:i.active)?a.afterClosed():ot.a}canActivate(t,e){var o;const n=t.paramMap.get("code");if(V.a.isValid(n)){const t=null!==(o=this.userSetup.getStoredValue())&&void 0!==o?o:{};return t.pitch||this.userSetup.store(Object.assign(t,{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(d.Xb(nt.b),d.Xb(_.b))},t.\u0275prov=d.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),at=(()=>{class t{constructor(t,e){this._dialog=t,this.userSetup=e}canDeactivate(t,e,o,n){var i;const a=this._dialog.open(p.b,{data:{header:"Finalizar chamada",body:"Cancele para continuar na chamada ou encerre confirmando"}});return(null===(i=t.localStream)||void 0===i?void 0:i.active)?a.afterClosed():ot.a}canActivate(t,e){var o;const n=t.paramMap.get("code");if(V.a.isValid(n)){const t=null!==(o=this.userSetup.getStoredValue())&&void 0!==o?o:{};return t.pitch||this.userSetup.store(Object.assign(t,{pitch:0})),!0}}}return t.\u0275fac=function(e){return new(e||t)(d.Xb(nt.b),d.Xb(_.b))},t.\u0275prov=d.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),st=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},imports:[[w.d.forChild([{path:"",component:W},{path:"create",component:z},{path:"dialup",component:v},{path:"invite",canActivate:[et],component:N},{path:"invite/:code",canActivate:[et],component:N},{path:":code",redirectTo:":code/meet"},{path:":code/room",canActivate:[at],canDeactivate:[at],component:tt},{path:":code/meet",canActivate:[it],canDeactivate:[it],component:q}])],w.d]}),t})(),ct=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},imports:[[b.c]]}),t})();var rt=o("0MNC"),lt=o("+rOU"),bt=o("u47x");let dt=(()=>{class t{}return t.\u0275mod=d.Lb({type:t}),t.\u0275inj=d.Kb({factory:function(e){return new(e||t)},providers:[H],imports:[[b.c,bt.a,ct,lt.f,p.l,p.e,p.p,p.a,p.j,h,p.h,rt.c,p.d,p.i,p.m,u.a,m.b,l.o,st]]}),t})()}}]);